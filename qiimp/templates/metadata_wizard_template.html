{% import qiimp.metadata_wizard_settings as mws %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QIIMP</title>
    <link href="static/third-party/favicon.ico" rel="icon" type="image/x-icon" />
    <link href="static/third-party/jQuery-File-Upload-9.19.2/css/jquery.fileupload.css" rel="stylesheet" />
    <!--Below included for consistency with Qiita "look"-->
    <link rel="stylesheet" href="static/third-party/jquery-ui-1.12.1/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="static/third-party/jquery-ui-1.12.1/jquery-ui.structure.min.css" type="text/css">
    <link rel="stylesheet" href="static/third-party/jquery-ui-1.12.1/jquery-ui.theme.min.css" type="text/css">
    <link rel="stylesheet" href="static/third-party/bootstrap-3.3.7-dist/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="static/third-party/bootstrap-3.3.7-dist/css/bootstrap-theme.min.css" type="text/css">
    <style type="text/css">
        select {
            padding: 4px;
        }
        .no-border {
            border: 0;
        }
        .left-detail-block {
        }
        .detail-row {
            width: 100%;
        }
        .detail-cell {
            border-bottom: 1px solid black;
            padding-top: 3px;
            padding-bottom: 3px;
            padding-left: 3px;
        }
        .detail-cell-no-bottom-border {
            padding-top: 3px;
            padding-bottom: 3px;
            padding-left: 3px;
        }
        .interior-cell {
            padding-right: 2px;
        }
        legend {
            color: #565656;
            font-size: medium;
            font-weight: bold;
            margin-bottom: 0;
        }
        .fieldTemplate {
            display:none;
        }
        .floating {
        }
        .field {
            padding: 2px;
            border-top: 1px solid black;
        }
        .buttons {
            padding: 2px;
            border-top: 1px solid black;
        }
        .error_list {
            padding-left: 40px;
            list-style-type: circle;
        }
        .error_item {
            list-style-type: circle;
        }
        .error_msg {
            color: orangered;
            margin: 5px;
        }
        .bar {
            height: 18px;
            background: green;
        }
        .Table {
            display: table;
            width: 100%;
            border-collapse: collapse;
        }
        .NarrowTable {
            display: table;
            border-collapse: collapse;
        }
        .Row {
            display: table-row;
            width: 100%;
        }
        .Cell {
            display: table-cell;
            vertical-align: top;
        }
        .left-cell {
            width: 50%;
        }
        .right-cell {
            width: 50%;
            border-left: 1px solid black;
        }
        .field-type {
            width: 125px;
        }
        .padded-cell {
            padding-left: 10px;
        }
        .description-cell {
            border: 1px solid black;
            vertical-align: top;
            padding: 5px;
        }
        .fully-padded-cell {
            padding: 10px;
        }
    </style>

    <!-- jquery -->
    <script src="static/third-party/jquery-3.2.1.min.js"></script>

    <!-- jquery validation plugin -->
    <script src="static/third-party/jquery_validation/jquery.validate.min.js"></script>
    <script src="static/third-party/jquery_validation/additional-methods.min.js"></script>

    <!--jquery UI and bootstrap plugins-->
    <script src="static/third-party/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="static/third-party/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

    <!-- jquery file upload plugin -->
    <script src="static/third-party/jQuery-File-Upload-9.19.2/js/vendor/jquery.ui.widget.js"></script>
    <script src="static/third-party/jQuery-File-Upload-9.19.2/js/jquery.iframe-transport.js"></script>
    <script src="static/third-party/jQuery-File-Upload-9.19.2/js/jquery.fileupload.js"></script>

    <!-- moment (for date/time validation) -->
    <script src="static/third-party/moment.min.js"></script>

    <!--bespoke javascript-->
    <script src="static/client_scripts/metadataWizardHelpers.js"></script>
    <script src="static/client_scripts/metadataWizardEventHandlers.js"></script>
    <script src="static/client_scripts/packageWizard.js"></script>
    <script src="static/client_scripts/metadataWizard.js"></script>


    <script type="text/javascript">
        g_transferred_variables.UPLOAD_URL = "{{ wiz_state.full_upload_url }}";
        g_transferred_variables.PACKAGE_PARTIAL_URL = "{{ wiz_state.partial_package_url }}";
        g_transferred_variables.MAX_SELECTBOX_SIZE = {{select_size}};
        g_transferred_variables.NO_DEFAULT_RADIO_VALUE = "{{mws.DefaultTypes.no_default.name}}";
        g_transferred_variables.SEPARATOR = "{{mws.SEPARATOR}}";
        g_transferred_variables.TEMPLATE_SUFFIX = "{{mws.TEMPLATE_SUFFIX}}";
        g_transferred_variables.FIELD_NAME_REGEX = /{{ mws.FIELD_NAME_REGEX }}/;
        g_transferred_variables.SAMPLETYPES_BY_ENV = JSON.parse('{% raw sampletypes_by_env_json %}');
        g_transferred_variables.RESERVED_SUFFIXES = ["{{mws.UNITS_SUFFIX}}", "{{mws.PHI_SUFFIX}}"];

        // Note that these are to be the bases (without template suffix or separator)
        g_transferred_variables.ELEMENT_IDENTIFIERS = {
            FIELD_NAME: "{{mws.InputNames.field_name.value}}",
            FIELD_TYPE: "{{mws.InputNames.field_type.value}}",
            ALLOWED_MISSINGS: "allowed_missing_vals_fieldset",
            DATA_TYPE: "{{mws.InputNames.data_type.value}}",
            TRUE_VALUE: "{{mws.InputNames.true_value.value}}",
            FALSE_VALUE: "{{mws.InputNames.false_value.value}}",
            MINIMUM: "{{mws.InputNames.minimum_value.value}}",
            MIN_COMPARE: "{{mws.InputNames.minimum_comparison.value}}",
            MAXIMUM: "{{mws.InputNames.maximum_value.value}}",
            MAX_COMPARE: "{{mws.InputNames.maximum_comparison.value}}",
            UNITS: "{{mws.InputNames.units.value}}",
            IS_UNITLESS: "{{mws.InputNames.is_unitless.value}}",
            CATEGORY_VALS: "{{mws.InputNames.categorical_values.value}}",
            DEFAULT_MISSINGS: "{{mws.InputNames.allowed_missing_default_select.value}}",
            DEFAULT_OPTION: "{{mws.InputNames.default_value.value}}",
            DEFAULT_CATEGORICAL: "{{mws.InputNames.categorical_default_select.value}}",
            DEFAULT_BOOLEAN: "{{mws.InputNames.boolean_default_select.value}}",
            DEFAULT_CONTINUOUS: "{{mws.InputNames.continuous_default.value}}",
            DEFAULT_TEXT: "{{mws.InputNames.text_default.value}}",
            DEFAULT_DATETIME: "{{mws.InputNames.datetime_default.value}}",
            REMOVE_FIELD: "remove_field",
            FIELD_NAMES: "field_names",  //NB: totally distinct from singular FIELD_NAME
            FIELD_NAMES_SELECT: "field_names_sel",
            CUSTOM_FIELDS_DIV: "custom_fields_div",
            NO_PACKAGE_WARNING_DIV: "no_package_warning_div",
            FIELD_DETAILS: "field_details",
            FIELD_DETAILS_DIV: "field_details_div",
            PACKAGE_DETAILS_DIV: "package_details_div",
            EXISTING_FIELDS_DIV: "existing_fields",
            ENV_FIELD: "{{mws.InputNames.environment.value}}",
            SAMPLE_TYPE_FIELD: "{{mws.InputNames.sample_type.value}}",
            UNITS_DIV: "units_div"
        };

        g_transferred_variables.SHOWN_ELEMENTS_BY_FIELD_TYPE = {
            "":[],
            "{{mws.FieldTypes.Text.value}}":["text_default_div"],
            "{{mws.FieldTypes.Boolean.value}}": ["boolean_div", "allowed_missing_vals_div",
                "allowed_missing_default_div", "boolean_default_div"],
            "{{mws.FieldTypes.Continuous.value}}": ["continuous_datatype_units_div",
                "continuous_min_max_div", "allowed_missing_vals_div",
                "allowed_missing_default_div", "continuous_default_div"],
            "{{mws.FieldTypes.Categorical.value}}": ["categorical_div", "allowed_missing_vals_div",
                "allowed_missing_default_div", "categorical_default_div"]
        };

        // slightly modified from https://github.com/biocore/qiita/blob/5b54aa7e445dd38b34373d9aa72481ffa7d214a4/qiita_pet/templates/sitebase.html#L82-L123
        function overlay_check() {
            // from http://stackoverflow.com/q/5916900/379593
            var ua=navigator.userAgent;
            var tem;
            var M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
            if(/trident/i.test(M[1])){
              tem=/\brv[ :]+(\d+)/g.exec(ua) || [];
              return 'IE '+(tem[1]||'');
            }
            if(M[1]==='Chrome'){
              tem=ua.match(/\bOPR\/(\d+)/);
              if(tem!=null)   {return 'Opera '+tem[1];}
            }
            M=M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
            if((tem=ua.match(/version\/(\d+)/i))!=null) {M.splice(1,1,tem[1]);}
            objbrowserName = M[0];
            objBrMajorVersion = M[1];
            if ((objbrowserName == "Chrome"  && objBrMajorVersion < {{allowed_min_browser_versions['chrome']}})
                {% if 'firefox' in allowed_min_browser_versions %}
                  || (objbrowserName == "Firefox" && objBrMajorVersion < {{allowed_min_browser_versions['firefox']}})
                {% else %}
                  || (objbrowserName == "Firefox")
                {% end %}
                {% if 'safari' in allowed_min_browser_versions %}
                  || (objbrowserName == "Safari"  && objBrMajorVersion < {{allowed_min_browser_versions['safari']}})
                {% else %}
                  || (objbrowserName == "Safari")
                {% end %}
                {% if 'IE' in allowed_min_browser_versions %}
                  || ((objbrowserName == "IE" || objbrowserName == "MSIE") && objBrMajorVersion < {{allowed_min_browser_versions['IE']}})
                {% else %}
                  || (objbrowserName == "IE" || objbrowserName == "MSIE")
                {% end %}
              ) {
              // Show overlay because too old a browser
              ol = document.getElementById("overlay");
              ol.style.visibility = "visible";
              //navbar = document.getElementById("navigation-bar");
              //navbar.style.visibility = "hidden";
            }
          };

        function updateTypeValidation(base_name, field_index, data_type_value){
            // get the relevant input field and remove any existing validation rules related to data type (only)
            var input_id_selector = getIdSelectorFromBaseNameAndFieldIndex(base_name, field_index);
            $(input_id_selector).rules( "remove", "digits number isValidDateTime" );

            // add back any required data type validation rule
            switch (data_type_value) {
                case "{{mws.CerberusDataTypes.Integer.value}}":
                    $(input_id_selector).rules("add", {digits: true});
                    break;
                case "{{mws.CerberusDataTypes.Decimal.value}}":
                    $(input_id_selector).rules("add", {number: true});
                    break;
                case "{{mws.CerberusDataTypes.DateTime.value}}":
                    $(input_id_selector).rules("add", {isValidDateTime: true});
                    break;
                case "{{mws.CerberusDataTypes.Text.value}}":
                    // no known validation required for text; perhaps length?
                    break;
                default:
                    alert("Unexpected data type value: '" + data_type_value + "'")
            }
        }

        function showHideUnits(field_index, data_type_value) {
            var show_units = !(data_type_value === "{{mws.CerberusDataTypes.DateTime.value}}");
            var units_div_id_selector = getIdSelectorFromBaseNameAndFieldIndex(g_transferred_variables.ELEMENT_IDENTIFIERS.UNITS_DIV, field_index);
            showEnableOrHideDisable(units_div_id_selector, show_units);
            return show_units;
        }

        function enableDisableDefaultSelects(field_index, curr_val){
            enableOrDisableByValue(g_transferred_variables.ELEMENT_IDENTIFIERS.DEFAULT_MISSINGS, field_index, curr_val,
                    "{{mws.DefaultTypes.allowed_missing_default.value}}");
            enableOrDisableByValue(g_transferred_variables.ELEMENT_IDENTIFIERS.DEFAULT_CATEGORICAL, field_index, curr_val,
                    "{{mws.DefaultTypes.categorical_default.value}}");
            enableOrDisableByValue(g_transferred_variables.ELEMENT_IDENTIFIERS.DEFAULT_BOOLEAN, field_index, curr_val,
                    "{{mws.DefaultTypes.boolean_default.value}}");
            enableOrDisableByValue(g_transferred_variables.ELEMENT_IDENTIFIERS.DEFAULT_CONTINUOUS, field_index, curr_val,
                    "{{mws.DefaultTypes.continuous_default.value}}");
            enableOrDisableByValue(g_transferred_variables.ELEMENT_IDENTIFIERS.DEFAULT_TEXT, field_index, curr_val,
                    "{{mws.DefaultTypes.text_default.value}}");
        };
    </script>
</head>
<body onload='overlay_check();'>
<form id ="metadata_form" method="post" action="">
<div class="container" id="container">
    <div class="row">
        <div class="col-sm-12">
            <h1>QIIMP</h1>
            <div>
                {% raw wiz_state.TUTORIAL_BLURB %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div id="accordion" class="panel-group">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            <a data-toggle="collapse" href="#collapseOne">Study Description</a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="NarrowTable">
                                        <div class="Row">
                                            <div class="Cell fully-padded-cell">
                                                <label id = "label_{{mws.InputNames.study_name.value}}" for="{{mws.InputNames.study_name.value}}"> Study Name:</label>
                                            </div>
                                            <div class="Cell fully-padded-cell">
                                                <input id="{{mws.InputNames.study_name.value}}" name = "{{mws.InputNames.study_name.value}}" type="text" placeholder="Study name" />
                                            </div>
                                        </div>
                                        <div class="Row">
                                            <div class="Cell fully-padded-cell">
                                                <label id="label_default_study_location_select" for="default_study_location_select">Default Study City/Locale:</label>
                                            </div>
                                            <div class="Cell fully-padded-cell">
                                                <select name="default_study_location_select" id="default_study_location_select" size={{len(wiz_state.default_locales_list)}} required>
                                                    {% for curr_locale_dict in wiz_state.default_locales_list %}
                                                    {% set curr_key, _ = mws.get_single_key_and_subdict(curr_locale_dict) %}
                                                    <option value="{{ curr_key }}">{{ curr_key }}</option>
                                                    {% end %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            <a data-toggle="collapse" href="#collapseTwo">Package Fields</a>
                        </h4>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse">
                        <div class="panel-body">
                            <div id="package_div">
                                <div class="row" id="mode_div">
                                    <div class="col-sm-12">
                                        <div class="NarrowTable">
                                            <div class="Row">
                                                <div class="Cell">
                                                    <div class="NarrowTable">
                                                        <div class="Row">
                                                            <div class="Cell fully-padded-cell">
                                                                <label id="label_metadata_mode_wizard" for="metadata_mode_wizard">Use Wizard</label>
                                                            </div>
                                                            <div class="Cell fully-padded-cell">
                                                                <input type="radio" name="metadata_mode" id = "metadata_mode_wizard" value="wizard" onchange="onModeChange(this)">&nbsp;
                                                            </div>
                                                        </div>
                                                        <div class="Row">
                                                            <div class="Cell fully-padded-cell">
                                                                <label id="label_metadata_mode_power" for="metadata_mode_power">Select Manually</label>
                                                            </div>
                                                            <div class="Cell fully-padded-cell">
                                                                <input type="radio" name="metadata_mode" id = "metadata_mode_power" value="power" onchange="onModeChange(this)">&nbsp;
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="Cell fully-padded-cell">
                                                    <div id="power_div" class="hidden">
                                                        <label id="label_package_select" for="package_select"> Metadata Packages:</label><br />
                                                        <select class = "error-below" name="package_select" id="package_select" size="{{select_size}}" disabled required>
                                                                    {% for curr_item in combinations_list %}
                                                                    <option value="{{curr_item[mws.NAME_KEY]}}">{{curr_item[mws.DISPLAY_NAME_KEY]}}</option>
                                                                    {% end %}
                                                        </select>
                                                    </div>
                                                    <div id="wizard_div" class="NarrowTable hidden">
                                                        <div class="Row">
                                                            <div class="Cell padded-cell" id="host_div">
                                                                <label id="label_host_select" for="host_select"> Host/Environment:</label><br />
                                                                <select class = "error-below" name="host_select" id="host_select" size="{{select_size}}" onchange="onHostChange(event);" disabled required>
                                                                    {% for curr_item in hosts_list %}
                                                                    <option value="{{curr_item[mws.NAME_KEY]}}">{{curr_item[mws.DISPLAY_NAME_KEY]}}</option>
                                                                    {% end %}
                                                                </select>
                                                            </div>
                                                            <div class="Cell padded-cell hidden" id="sample_type_div">
                                                                <label id="label_sample_type_select" for="sample_type_select"> Sample Type:</label><br />
                                                                <select class = "error-below" name="sample_type_select" id="sample_type_select" size="{{select_size}}" disabled required>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" id="select_package_button_div">
                                    <div class="col-sm-12">
                                        <input type = "hidden" id="env" name="env" value="" />
                                        <input type = "hidden" id="sample_type" name="sample_type" value="" />
                                        <button name="select_package_button" id="select_package_button" type="button"
                                                onclick="onSelectPackage();validateFormIfSubmitted();" disabled>Select Package</button>
                                    </div>
                                </div>
                                <div class="row" id="package_details_div">
                                    <br />
                                    <br />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            <a data-toggle="collapse" href="#collapseThree">Custom Fields</a>
                        </h4>
                    </div>
                    <div id="collapseThree" class="panel-collapse collapse">
                        <div class="panel-body">
                            <div id="no_package_warning_div">
                                Please select a package before entering custom fields.
                            </div>
                            <div id="custom_fields_div" class="hidden">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <p>
                                            Enter custom fields by typing their names into the box below and/or uploading them from a previously created QIIMP file:
                                        </p>
                                        <label class="hidden" id="label_field_names" for="field_names">Custom Fields:</label>
                                        <textarea rows="5" cols="25" name="field_names" id="field_names" placeholder="e.g., phenotype&#10;timepoint&#10;disease_state"></textarea><br />
                                        <br />&nbsp;
                                        <input type="button" value="Add Field" id="addField" onclick="clickAddField(this);validateFormIfSubmitted();">
                                    </div>
                                </div>
                                <div class="row">
                                    <div id="existing_div" class="col-sm-12">
                                        <!-- from https://blueimp.github.io/jQuery-File-Upload/basic.html -->
                                        <div class="col=sm-12">
                                            and/or<br />
                                            <label class="hidden" id = "label_upload_file_name" for="upload_file_name">Existing QIIMP Spreadsheet:</label>
                                            <input id="fileupload" type="file" name="files[]" disabled style="color:transparent;">
                                            <!-- The global progress bar -->
                                            <div id="progress">
                                                <div class="bar" style="width: 0%;"></div>
                                            </div>
                                            <!-- The container for the uploaded files -->
                                            <div id="files" class="files"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Table hidden" id="existing_fields">
                                    <div class="Row">
                                        <div class="Cell"><label id="label_field_names_sel" for="field_names_sel"><strong>Field Name</strong></label></div>
                                        <div class="Cell">
                                            <div class="Row">
                                                <div class="Cell field-type"><strong>Field Type</strong></div>
                                                <div class="Cell"><strong>Field Details</strong></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Row">
                                        <div class="Cell detail-cell-no-bottom-border" style="width: 1%;">
                                            <select name="field_names_sel" id="field_names_sel" size="{{select_size}}" onchange="onSelectedFieldNameChange(this)">
                                            </select>
                                        </div>
                                        <div class="Cell" id="field_details_div">
                                        </div>
                                    </div>
                                    <div class="fieldTemplate hidden">
                                        <div class="Row field hidden" id="field_details{{mws.TEMPLATE_SUFFIX}}">
                                            <div class="Cell detail-cell-no-bottom-border field-type">
                                                <input type="hidden" name="{{mws.InputNames.field_name.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.field_name.name}}{{mws.TEMPLATE_SUFFIX}}">
                                                <label class="hidden" id="label_{{mws.InputNames.field_type.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.field_type.value}}{{mws.TEMPLATE_SUFFIX}}">Field Type</label>
                                                <select name="{{mws.InputNames.field_type.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.field_type.name}}{{mws.TEMPLATE_SUFFIX}}" size={{len(mws.FieldTypes)}} >
                                                    {% for curr_enum in mws.FieldTypes %}
                                                    <!--<option value="{{curr_enum.value}}" title="{{wiz_state.FIELD_TYPE_TOOLTIPS[curr_enum.value]}}">{{curr_enum.name}}</option>-->
                                                    <option value="{{curr_enum.value}}">{{wiz_state.FIELD_TYPE_TOOLTIPS[curr_enum.value]}}</option>
                                                    {% end %}
                                                </select>
                                            </div>
                                            <div class="Cell">
                                                <div class="Table">
                                                    <div class="Row">
                                                        <div class="Cell left-cell detail-cell">
                                                            <div class="Row">
                                                                <div class="Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.field_desc.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.field_desc.value}}{{mws.TEMPLATE_SUFFIX}}">Description:</label>
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <textarea rows=4 placeholder="e.g., the age of the subject in years" name="{{mws.InputNames.field_desc.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.field_desc.name}}{{mws.TEMPLATE_SUFFIX}}" ></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="Row">
                                                                <div class="Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.is_phi.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.is_phi.value}}{{mws.TEMPLATE_SUFFIX}}">Protected Health Info:</label>
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <input type="checkbox" name="{{mws.InputNames.is_phi.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.is_phi.name}}{{mws.TEMPLATE_SUFFIX}}" value="True">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="Cell initially_hidden hidden right-cell detail-cell" id="allowed_missing_vals_div{{mws.TEMPLATE_SUFFIX}}">
                                                            <fieldset name="allowed_missing_vals_fieldset{{mws.TEMPLATE_SUFFIX}}" id="allowed_missing_vals_fieldset{{mws.TEMPLATE_SUFFIX}}">
                                                                <legend>Allowed Missing Values (Optional)</legend>
                                                                {% for curr_enum in mws.EbiMissingValues %}
                                                                <input type="checkbox" name="{{mws.InputNames.allowed_missing_vals.name}}{{mws.TEMPLATE_SUFFIX}}[]" id="{{mws.InputNames.allowed_missing_vals.name}}_{{curr_enum.name}}{{mws.TEMPLATE_SUFFIX}}" value="{{curr_enum.name}}" disabled /> {{curr_enum.value}}<br />
                                                                {% end %}
                                                            </fieldset>
                                                        </div>
                                                    </div>
                                                    <div class="initially_hidden hidden Row detail-row" id="boolean_div{{mws.TEMPLATE_SUFFIX}}">
                                                        <div class="Cell left-detail-block left-cell detail-cell">
                                                            <div class="Row">
                                                                <div class="Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.true_value.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.true_value.value}}{{mws.TEMPLATE_SUFFIX}}">True Value:</label>
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <input type ="text" name="{{mws.InputNames.true_value.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.true_value.name}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g., Yes" disabled required/><br />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="Cell right-cell detail-cell">
                                                            <div class="Row">
                                                                <div class="Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.false_value.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.false_value.value}}{{mws.TEMPLATE_SUFFIX}}">False Value:</label>
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <input type ="text" name="{{mws.InputNames.false_value.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.false_value.name}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g., No" disabled required/><br />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="initially_hidden hidden Row detail-row" id="continuous_datatype_units_div{{mws.TEMPLATE_SUFFIX}}">
                                                        <div class="Cell left-detail-block left-cell detail-cell">
                                                            <div class="Row">
                                                                <div class = "Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.data_type.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.data_type.value}}{{mws.TEMPLATE_SUFFIX}}">Data Type:</label>
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <select name="{{mws.InputNames.data_type.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.data_type.name}}{{mws.TEMPLATE_SUFFIX}}" size="{{len(mws.CerberusDataTypes)-1}}" disabled required>
                                                                        {% for curr_enum in mws.CerberusDataTypes %}
                                                                            {% if curr_enum is not mws.CerberusDataTypes.Text %}
                                                                                <option value="{{curr_enum.value}}">{{curr_enum.name}}</option>
                                                                            {% end %}
                                                                        {% end %}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="Cell right-cell detail-cell">
                                                            <div class="Row hidden" id="units_div{{mws.TEMPLATE_SUFFIX}}">
                                                                <div class = "Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.units.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.units.value}}{{mws.TEMPLATE_SUFFIX}}">Units:</label>
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <input name="{{mws.InputNames.units.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.units.name}}{{mws.TEMPLATE_SUFFIX}}" type="text" placeholder="e.g., years"  disabled required/>
                                                                    <p>or</p>
                                                                    <input type="checkbox" name="{{mws.InputNames.is_unitless.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.is_unitless.value}}{{mws.TEMPLATE_SUFFIX}}" value="True">
                                                                    <label id="label_{{mws.InputNames.is_unitless.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.is_unitless.value}}{{mws.TEMPLATE_SUFFIX}}">Is unitless</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="initially_hidden hidden Row detail-row" id="continuous_min_max_div{{mws.TEMPLATE_SUFFIX}}">
                                                        <div class = "Cell left-detail-block left-cell detail-cell">
                                                            <fieldset name="minimum_{{mws.TEMPLATE_SUFFIX}}">
                                                                <legend>Minimum (Optional)</legend>
                                                                <div class="Row">
                                                                    <div class="Cell interior-cell">
                                                                        <label id="label_{{mws.InputNames.minimum_comparison.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.minimum_comparison.value}}{{mws.TEMPLATE_SUFFIX}}"><span class="hidden">Minimum</span> Comparison</label>
                                                                    </div>
                                                                    <div class="Cell interior-cell">
                                                                        <select name="{{mws.InputNames.minimum_comparison.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.minimum_comparison.name}}{{mws.TEMPLATE_SUFFIX}}" size="3" disabled required>
                                                                            <option value="no_comparison" selected="selected">None</option>
                                                                            <option value="{{mws.ValidationKeys.min_exclusive.value}}">Greater Than</option>
                                                                            <option value="{{mws.ValidationKeys.min_inclusive.value}}">Greater Than Or Equal To</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="Row">
                                                                    <div class="Cell interior-cell">
                                                                        <label id="label_{{mws.InputNames.minimum_value.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.minimum_value.value}}{{mws.TEMPLATE_SUFFIX}}"><span class="hidden">Minimum</span> Value</label>
                                                                    </div>
                                                                    <div class="Cell interior-cell">
                                                                        <input type ="text" name="{{mws.InputNames.minimum_value.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.minimum_value.name}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g., 3"  disabled/>
                                                                    </div>
                                                                </div>
                                                            </fieldset>
                                                        </div>
                                                        <div class="Cell right-cell detail-cell">
                                                            <fieldset name="minimum_{{mws.TEMPLATE_SUFFIX}}">
                                                                <legend>Maximum (Optional)</legend>
                                                                <div class="Row">
                                                                    <div class="Cell interior-cell">
                                                                        <label id="label_{{mws.InputNames.maximum_comparison.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.maximum_comparison.value}}{{mws.TEMPLATE_SUFFIX}}"><span class="hidden">Maximum</span> Comparison</label>
                                                                    </div>
                                                                    <div class="Cell interior-cell">
                                                                        <select name="{{mws.InputNames.maximum_comparison.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.maximum_comparison.name}}{{mws.TEMPLATE_SUFFIX}}" size="3" disabled required>
                                                                            <option value="no_comparison" selected="selected">None</option>
                                                                            <option value="{{mws.ValidationKeys.max_exclusive.value}}">Less Than</option>
                                                                            <option value="{{mws.ValidationKeys.max_inclusive.value}}">Less Than Or Equal To</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="Row">
                                                                    <div class="Cell interior-cell">
                                                                        <label id="label_{{mws.InputNames.maximum_value.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.maximum_value.value}}{{mws.TEMPLATE_SUFFIX}}"><span class="hidden">Maximum</span> Value</label>
                                                                    </div>
                                                                    <div class="Cell interior-cell">
                                                                        <input type ="text" name="{{mws.InputNames.maximum_value.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.maximum_value.name}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g, 10"  disabled/><br />
                                                                    </div>
                                                                </div>
                                                            </fieldset>
                                                        </div>
                                                    </div>
                                                    <div class="initially_hidden hidden Row detail-row" id="categorical_div{{mws.TEMPLATE_SUFFIX}}">
                                                        <div class="Cell left-cell detail-cell">
                                                            <div class="Row">
                                                                <div class="Cell interior-cell">
                                                                    <label id="label_{{mws.InputNames.categorical_values.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.categorical_values.value}}{{mws.TEMPLATE_SUFFIX}}">Categorical Values</label> (One Per Line)
                                                                </div>
                                                                <div class="Cell interior-cell">
                                                                    <textarea rows="5" cols="25" name="{{mws.InputNames.categorical_values.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.categorical_values.name}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g., Low&#10;Medium&#10;High" disabled required></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="Row detail-row">
                                                        <div class="Cell detail-cell">
                                                            <fieldset name="defaults{{mws.TEMPLATE_SUFFIX}}">
                                                                <legend>Default Value</legend>
                                                                <div class="Row">
                                                                    <div class="Cell">
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell">
                                                                                <input type="radio" name="{{mws.InputNames.default_value.value}}{{mws.TEMPLATE_SUFFIX}}" id = "{{mws.DefaultTypes.no_default.name}}{{mws.TEMPLATE_SUFFIX}}" value="{{mws.DefaultTypes.no_default.name}}" checked="checked">
                                                                            </div>
                                                                            <div class="Cell interior-cell">
                                                                                <label id="label_no_default{{mws.TEMPLATE_SUFFIX}}" for="no_default{{mws.TEMPLATE_SUFFIX}}">No Default</label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="initially_hidden hidden Row" id="allowed_missing_default_div{{mws.TEMPLATE_SUFFIX}}">
                                                                    <div class="Cell">
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell">
                                                                                <input type="radio" name="{{mws.InputNames.default_value.value}}{{mws.TEMPLATE_SUFFIX}}" id = "allowed_missing_default{{mws.TEMPLATE_SUFFIX}}" value="allowed_missing_default">
                                                                            </div>
                                                                            <div class="Cell interior-cell">
                                                                                <label id="label_{{mws.InputNames.allowed_missing_default_select.value}}{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.allowed_missing_default_select.value}}{{mws.TEMPLATE_SUFFIX}}">Allowed Missing Default</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell"></div>
                                                                            <div class="Cell interior-cell">
                                                                                <select name="{{mws.InputNames.allowed_missing_default_select.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.allowed_missing_default_select.name}}{{mws.TEMPLATE_SUFFIX}}" size="{{len(mws.EbiMissingValues)}}" disabled required>
                                                                                    {% for curr_enum in mws.EbiMissingValues %}
                                                                                    <option value="{{curr_enum.name}}" disabled>{{curr_enum.value}}</option>
                                                                                    {% end %}
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="initially_hidden hidden Row" id="categorical_default_div{{mws.TEMPLATE_SUFFIX}}">
                                                                    <div class="Cell">
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell">
                                                                                <input type="radio" name="{{mws.InputNames.default_value.value}}{{mws.TEMPLATE_SUFFIX}}" id = "categorical_default{{mws.TEMPLATE_SUFFIX}}" value="{{mws.DefaultTypes.categorical_default.name}}">
                                                                            </div>
                                                                            <div class="Cell interior-cell">
                                                                                <label id="label_categorical_default{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.categorical_default_select.value}}{{mws.TEMPLATE_SUFFIX}}">Categorical Default</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell"></div>
                                                                            <div class="Cell interior-cell">
                                                                                <select name="{{mws.InputNames.categorical_default_select.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.categorical_default_select.name}}{{mws.TEMPLATE_SUFFIX}}" size="1" disabled required></select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="initially_hidden hidden Row" id = "continuous_default_div{{mws.TEMPLATE_SUFFIX}}">
                                                                    <div class="Cell">
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell">
                                                                                <input type="radio" name="{{mws.InputNames.default_value.value}}{{mws.TEMPLATE_SUFFIX}}" id = "continuous_default_value{{mws.TEMPLATE_SUFFIX}}" value="{{mws.DefaultTypes.continuous_default.name}}">
                                                                            </div>
                                                                            <div class="Cell interior-cell">
                                                                                <label id="label_continuous_default{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.continuous_default.value}}{{mws.TEMPLATE_SUFFIX}}">Continuous Default</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="Row">
                                                                                <div class="Cell interior-cell"></div>
                                                                                <div class="Cell interior-cell">
                                                                                    <input type="text" name="{{mws.InputNames.continuous_default.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.continuous_default.name}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g., 3" disabled required>
                                                                                </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="initially_hidden hidden Row" id = "boolean_default_div{{mws.TEMPLATE_SUFFIX}}">
                                                                    <div class="Cell">
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell">
                                                                                <input type="radio" name="{{mws.InputNames.default_value.value}}{{mws.TEMPLATE_SUFFIX}}" id = "boolean_default_value{{mws.TEMPLATE_SUFFIX}}" value="{{mws.DefaultTypes.boolean_default.name}}">
                                                                            </div>
                                                                            <div class="Cell interior-cell">
                                                                                <label id="label_boolean_default{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.boolean_default_select.value}}{{mws.TEMPLATE_SUFFIX}}">Boolean Default</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell"></div>
                                                                            <div class="Cell interior-cell">
                                                                                <select name="{{mws.InputNames.boolean_default_select.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.boolean_default_select.value}}{{mws.TEMPLATE_SUFFIX}}" size="1" disabled required></select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="initially_hidden hidden Row" id = "text_default_div{{mws.TEMPLATE_SUFFIX}}">
                                                                    <div class="Cell">
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell">
                                                                                <input type="radio" name="{{mws.InputNames.default_value.value}}{{mws.TEMPLATE_SUFFIX}}" id = "text_default_value{{mws.TEMPLATE_SUFFIX}}" value="{{mws.DefaultTypes.text_default.name}}">
                                                                            </div>
                                                                            <div class="Cell interior-cell">
                                                                                <label id="label_text_default{{mws.TEMPLATE_SUFFIX}}" for="{{mws.InputNames.text_default.value}}{{mws.TEMPLATE_SUFFIX}}">Text Default</label><br />
                                                                            </div>
                                                                        </div>
                                                                        <div class="Row">
                                                                            <div class="Cell interior-cell"></div>
                                                                            <div class="Cell interior-cell">
                                                                                <textarea name="{{mws.InputNames.text_default.value}}{{mws.TEMPLATE_SUFFIX}}" id="{{mws.InputNames.text_default.value}}{{mws.TEMPLATE_SUFFIX}}" placeholder="e.g., 0.5 ml subcutaneously" disabled required></textarea>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </fieldset>
                                                        </div>
                                                    </div>
                                                    <div class="Row detail-row">
                                                        <div class="Cell detail-cell-no-bottom-border">
                                                           <input type="button" value="Remove Field" name="remove_field{{mws.TEMPLATE_SUFFIX}}" id="remove_field{{mws.TEMPLATE_SUFFIX}}">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div id="error_summary_div" class="error_msg col-sm-12"></div>
        </div>
    </div>
    <div class="row buttons">
        <div class="col-sm-12">
            <input class="submit" style="float: right;" type="submit" value="Submit">
        </div>
    </div>
</div>
</form>
<!-- slightly modified from https://github.com/biocore/qiita/blob/5b54aa7e445dd38b34373d9aa72481ffa7d214a4/qiita_pet/templates/sitebase.html#L599-L613 -->
<div id="overlay" style="visibility: hidden; position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; font-size: 13px; text-align: center; z-index: 1000; background-color: #333333; color: #FFFFFF;">
  <h1>This site only works with the following browsers</h1>
  <p id="explanation"><strong>Chrome >= {{allowed_min_browser_versions['chrome']}}:</strong> You can download Chrome from <a href="https://www.google.com/chrome/browser/">here</a> or you can find instructions on how to update it <a href="https://support.google.com/chrome/answer/95414?hl=en">here</a></p>
  {% if 'safari' in allowed_min_browser_versions %}
    <p id="explanation"><strong>Safari >= {{allowed_min_browser_versions['safari']}}:</strong> You can update Safari following <a href="http://support.apple.com/en-us/HT6104">these</a> instructions.</p>
  {% end %}
  {% if 'firefox' in allowed_min_browser_versions %}
    <p id="explanation"><strong>Firefox >= {{allowed_min_browser_versions['firefox']}}:</strong> For instructions on how to install or update Firefox go <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">here.</a></p>
  {% end %}
  {% if 'IE' in allowed_min_browser_versions %}
    <p id="explanation"><strong>Internet Explorer >= {{allowed_min_browser_versions['IE']}}:</strong> For instructions on how to update IE go <a href="http://windows.microsoft.com/en-us/internet-explorer">here.</a></p>
  {% end %}
</div>
</body>
</html>
